<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tariff News Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f7fafc;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #2b6cb0;
      font-weight: 600;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 2.5rem;
      color: #2b6cb0;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .header p {
      font-size: 1.2rem;
      color: #555;
      margin-bottom: 0;
    }
    .names {
      font-size: 1.1rem;
      color: #2b6cb0;
      font-weight: 600;
    }
    input, button, select {
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ddd;
      width: 100%;
      font-size: 1rem;
    }
    button {
      background-color: #3182ce;
      color: white;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2b6cb0;
    }
    select {
      width: 100%;
      background-color: #f7fafc;
    }
    .description {
      background-color: #e2e8f0;
      padding: 20px;
      border-radius: 6px;
      margin-top: 25px;
      font-size: 1.1rem;
      text-align: center;
      color: #4a5568;
    }
    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 0.9rem;
      color: #718096;
    }
    .footer p {
      margin-bottom: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Tariff News Impact Dashboard</h1>
      <p class="names">Developed by Team 8: Max Maksutova, Mollie Schuma, Nicole Sellers, Sarah Wozniak</p>
    </div>

    <div class="description">
      <p>Welcome to the Tariff News Impact Dashboard! This tool allows you to view stock price changes for major companies and see the effect of tariff-related news on those stocks. You can select individual stocks or view the combined data of all selected stocks on the same graph. This will help visualize how tariff announcements impact the market.</p>
    </div>

    <!-- Dropdown for selecting stock or "All Stocks" -->
    <select id="stockSelect">
      <option value="ALL">All Stocks</option>
      <option value="AAPL">AAPL (Apple)</option>
      <option value="MSFT">MSFT (Microsoft)</option>
      <option value="TSLA">TSLA (Tesla)</option>
      <option value="NVDA">NVDA (NVIDIA)</option>
      <option value="AMZN">AMZN (Amazon)</option>
    </select>

    <button id="pullBtn">Pull Data</button>
    <div id="chart" style="margin-top: 30px;"></div>
    <div id="newsList" style="margin-top: 30px;"></div>
  </div>

  <div class="footer">
    <p>&copy; 2025 Tariff News Dashboard. All rights reserved.</p>
  </div>

  <script>
    const ALPHA_VANTAGE_KEY = 'DOMVA9UV2FOKZ2NJ';
    const NEWS_API_KEY = '8eb5058ccc8845ee8ee3e6fc45609e85';

    const stockSelect = document.getElementById("stockSelect");
    const pullBtn = document.getElementById("pullBtn");
    const chartContainer = document.getElementById("chart");
    const newsList = document.getElementById("newsList");

    const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours in ms

    function setChart(dates, prices, symbol) {
      const trace = {
        x: dates,
        y: prices,
        type: "scatter",
        mode: "lines+markers",
        line: { color: "#3182ce" },
        name: symbol
      };

      const layout = {
        title: "Stock Price Over Time",
        xaxis: { title: "Date" },
        yaxis: { title: "Price (USD)" },
      };

      Plotly.newPlot(chartContainer, [trace], layout);
    }

    async function getCachedData(symbol) {
      const cached = localStorage.getItem(`stock-${symbol}`);
      if (cached) {
        const { timestamp, dates, prices } = JSON.parse(cached);
        if (Date.now() - timestamp < CACHE_DURATION) {
          return { dates, prices };
        }
      }
      return null;
    }

    async function fetchStockData(symbol) {
      const cached = await getCachedData(symbol);
      if (cached) return cached;

      const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${ALPHA_VANTAGE_KEY}`;
      const response = await fetch(url);
      const data = await response.json();

      const timeSeries = data["Time Series (Daily)"];
      const dates = Object.keys(timeSeries).slice(0, 30).reverse();
      const prices = dates.map((date) => parseFloat(timeSeries[date]["4. close"]));

      localStorage.setItem(`stock-${symbol}`, JSON.stringify({
        timestamp: Date.now(),
        dates,
        prices
      }));

      return { dates, prices };
    }

    async function fetchNewsData(symbol) {
      const url = `https://newsapi.org/v2/everything?q=${symbol}+tariff&apiKey=${NEWS_API_KEY}`;
      const response = await fetch(url);
      const data = await response.json();
      return data.articles.slice(0, 5);
    }

    async function pullData() {
      const symbol = stockSelect.value;
      chartContainer.innerHTML = "Loading chart...";
      newsList.innerHTML = "Loading news...";

      if (symbol === "ALL") {
        const stocks = ["AAPL", "MSFT", "TSLA", "NVDA", "AMZN"];
        let allDates = [];
        let allPrices = [];
        for (let stock of stocks) {
          const { dates, prices } = await fetchStockData(stock);
          setChart(dates, prices, stock);
        }
      } else {
        const { dates, prices } = await fetchStockData(symbol);
        setChart(dates, prices, symbol);
      }

      const news = await fetchNewsData(symbol);
      newsList.innerHTML = "";
      news.forEach((article) => {
        const item = document.createElement("div");
        item.innerHTML = `
          <div class="border p-3 rounded shadow-sm mb-2 bg-white">
            <p class="font-semibold">${article.title}</p>
            <p class="text-sm text-gray-600">${new Date(article.publishedAt).toLocaleString()}</p>
            <p class="text-sm mt-1">${article.description}</p>
            <a href="${article.url}" target="_blank" class="text-blue-500 text-sm">Read more</a>
          </div>
        `;
        newsList.appendChild(item);
      });
    }

    pullBtn.addEventListener("click", pullData);
  </script>
</body>
</html>
