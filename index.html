<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tariff News Impact Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9fafb;
      margin: 0;
      padding: 20px;
      color: #1f2937;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    p.description {
      font-size: 1rem;
      color: #6b7280;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    select, button {
      padding: 10px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #d1d5db;
    }

    button {
      background-color: #2563eb;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #1d4ed8;
    }

    .news-item {
      margin-bottom: 15px;
      padding: 15px;
      border-left: 4px solid #2563eb;
      background-color: #f1f5f9;
      border-radius: 6px;
    }

    .news-item h3 {
      margin: 0;
      font-size: 1rem;
    }

    .news-item p {
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .footer {
      margin-top: 40px;
      font-size: 0.9rem;
      color: #6b7280;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tariff News Impact Dashboard</h1>
    <p class="description">
      Visualize how stock prices respond to major tariff and trade-related news events. Select a stock to analyze or compare them all. Built by Team 8.
    </p>

    <div class="form-group">
      <select id="stockSelect">
        <option value="AAPL">Apple (AAPL)</option>
        <option value="MSFT">Microsoft (MSFT)</option>
        <option value="TSLA">Tesla (TSLA)</option>
        <option value="GOOGL">Google (GOOGL)</option>
        <option value="AMZN">Amazon (AMZN)</option>
        <option value="ALL">All Stocks Combined</option>
      </select>
      <button onclick="pullData()">Pull Data</button>
    </div>

    <div id="chart" style="height: 500px;"></div>

    <h2 style="margin-top: 40px;">Recent Tariff News</h2>
    <div id="newsList"></div>

    <div class="footer">
      Dashboard powered by Alpha Vantage and NewsAPI | Designed by Max & Team
    </div>
  </div>

  <script>
    const ALPHA_VANTAGE_KEY = '8I92ZI5AWDK202T1';
    const NEWS_API_KEY = '8eb5058ccc8845ee8ee3e6fc45609e85';
    const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours
    const stockList = ['AAPL', 'MSFT', 'TSLA', 'GOOGL', 'AMZN'];

    async function getCachedData(symbol) {
      const cached = localStorage.getItem(`stock-${symbol}`);
      if (cached) {
        const { timestamp, dates, prices } = JSON.parse(cached);
        if (Date.now() - timestamp < CACHE_DURATION) {
          return { dates, prices };
        }
      }
      return null;
    }

    async function fetchStockData(symbol) {
      const cached = await getCachedData(symbol);
      if (cached) return cached;

      const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${ALPHA_VANTAGE_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      const timeSeries = data["Time Series (Daily)"];
      if (!timeSeries) return { dates: [], prices: [] };

      const dates = Object.keys(timeSeries).slice(0, 30).reverse();
      const prices = dates.map(date => parseFloat(timeSeries[date]["4. close"]));

      localStorage.setItem(`stock-${symbol}`, JSON.stringify({
        timestamp: Date.now(),
        dates,
        prices
      }));

      return { dates, prices };
    }

    function setChart(dataArray) {
      const traces = dataArray.map(({ symbol, dates, prices }, index) => ({
        x: dates,
        y: prices,
        mode: 'lines+markers',
        name: symbol,
        type: 'scatter'
      }));

      Plotly.newPlot("chart", traces, {
        title: "Stock Price Over Time",
        xaxis: { title: "Date" },
        yaxis: { title: "Price (USD)" },
        legend: { orientation: "h", y: -0.2 }
      });
    }

    async function fetchTariffNews() {
      const keywords = encodeURIComponent("tariff OR tariffs OR taxes OR China OR trade war");
      const url = `https://newsapi.org/v2/top-headlines?q=${keywords}&apiKey=${NEWS_API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      return data.articles.slice(0, 5);
    }

    async function pullData() {
      const symbol = document.getElementById("stockSelect").value;
      document.getElementById("chart").innerHTML = "Loading chart...";
      document.getElementById("newsList").innerHTML = "Loading news...";

      let chartData = [];

      if (symbol === "ALL") {
        for (const sym of stockList) {
          const data = await fetchStockData(sym);
          chartData.push({ symbol: sym, ...data });
        }
      } else {
        const data = await fetchStockData(symbol);
        chartData.push({ symbol, ...data });
      }

      setChart(chartData);

      const news = await fetchTariffNews();
      const newsContainer = document.getElementById("newsList");
      newsContainer.innerHTML = "";

      news.forEach(article => {
        const div = document.createElement("div");
        div.className = "news-item";
        div.innerHTML = `
          <h3>${article.title}</h3>
          <p><strong>${new Date(article.publishedAt).toLocaleDateString()}</strong> | ${article.source.name}</p>
          <p>${article.description || ""}</p>
          <a href="${article.url}" target="_blank">Read more</a>
        `;
        newsContainer.appendChild(div);
      });
    }
  </script>
</body>
</html>
